# Migration `20200417022021-migrate3`

This migration has been generated by Leo Vigna at 4/17/2020, 2:20:21 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
PRAGMA foreign_keys=OFF;

CREATE TABLE "quaint"."new_Contract" (
    "address" TEXT NOT NULL  ,
    "networkId" TEXT NOT NULL  ,
    "specId" INTEGER   ,
    PRIMARY KEY ("address"),FOREIGN KEY ("specId") REFERENCES "ContractDefinition"("id") ON DELETE SET NULL ON UPDATE CASCADE
) 

INSERT INTO "quaint"."new_Contract" ("address", "networkId") SELECT "address", "networkId" FROM "quaint"."Contract"

DROP TABLE "quaint"."Contract";

ALTER TABLE "quaint"."new_Contract" RENAME TO "Contract";

PRAGMA "quaint".foreign_key_check;

PRAGMA foreign_keys=ON;

PRAGMA foreign_keys=OFF;

CREATE TABLE "quaint"."new_Event" (
    "address" TEXT   ,
    "blockHash" TEXT   ,
    "blockNumber" INTEGER   ,
    "event" TEXT   ,
    "id" TEXT NOT NULL  ,
    "logIndex" INTEGER   ,
    "returnValues" TEXT   ,
    "signature" TEXT   ,
    "transactionHash" TEXT   ,
    "transactionIndex" INTEGER   ,
    PRIMARY KEY ("id")
) 

INSERT INTO "quaint"."new_Event" ("address", "blockHash", "blockNumber", "event", "id", "logIndex", "returnValues", "signature", "transactionHash", "transactionIndex") SELECT "address", "blockHash", "blockNumber", "event", "id", "logIndex", "returnValues", "signature", "transactionHash", "transactionIndex" FROM "quaint"."Event"

DROP TABLE "quaint"."Event";

ALTER TABLE "quaint"."new_Event" RENAME TO "Event";

PRAGMA "quaint".foreign_key_check;

PRAGMA foreign_keys=ON;

DROP TABLE "quaint"."new_Contract";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200417014005-migrate2..20200417022021-migrate3
--- datamodel.dml
+++ datamodel.dml
@@ -4,40 +4,46 @@
 }
 datasource db {
   provider = "sqlite"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 model Operator {
   id   Int    @default(autoincrement()) @id
   name String
 }
+model ContractDefinition {
+  id             Int        @default(autoincrement()) @id
+  compilerOutput String
+  contracts      Contract[]
+}
+
 model Contract {
-  address   String      @id
+  address   String              @id
   networkId String
-  events    EventType[] @relation("EventContracts", references: [name])
-  abi       String
+  events    EventType[]         @relation("EventContracts", references: [name])
+  spec      ContractDefinition? @relation(fields: [specId], references: [id])
+  specId    Int?
 }
 model EventType {
   name      String     @id
   contracts Contract[] @relation("EventContracts", references: [address])
 }
 model Event {
-  id               String @id
-  data             String
-  returnValues     String
-  event            String
-  signature        String
-  logIndex         Int
-  transactionIndex Int
-  transactionHash  String
-  blockHash        String
-  blockNumber      Int
-  address          String
+  id               String  @id
+  returnValues     String?
+  event            String?
+  signature        String?
+  logIndex         Int?
+  transactionIndex Int?
+  transactionHash  String?
+  blockHash        String?
+  blockNumber      Int?
+  address          String?
 }
 model OracleAggregator {
   id                 Int      @default(autoincrement()) @id
```


