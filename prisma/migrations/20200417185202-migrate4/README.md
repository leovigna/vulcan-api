# Migration `20200417185202-migrate4`

This migration has been generated by Leo Vigna at 4/17/2020, 6:52:02 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
PRAGMA foreign_keys=OFF;

CREATE TABLE "quaint"."new_OracleAggregator" (
    "answerRenderFormat" TEXT NOT NULL  ,
    "contractAddress" TEXT NOT NULL  ,
    "path" TEXT NOT NULL  ,
    "title" TEXT NOT NULL  ,
    PRIMARY KEY ("contractAddress"),FOREIGN KEY ("contractAddress") REFERENCES "Contract"("address") ON DELETE CASCADE ON UPDATE CASCADE
) 

INSERT INTO "quaint"."new_OracleAggregator" ("answerRenderFormat", "contractAddress", "path", "title") SELECT "answerRenderFormat", "contractAddress", "path", "title" FROM "quaint"."OracleAggregator"

DROP TABLE "quaint"."OracleAggregator";

ALTER TABLE "quaint"."new_OracleAggregator" RENAME TO "OracleAggregator";

PRAGMA "quaint".foreign_key_check;

PRAGMA foreign_keys=ON;

PRAGMA foreign_keys=OFF;

CREATE TABLE "quaint"."new_Event" (
    "address" TEXT   ,
    "blockHash" TEXT   ,
    "blockNumber" INTEGER   ,
    "event" TEXT   ,
    "id" TEXT NOT NULL  ,
    "logIndex" INTEGER   ,
    "returnValues" TEXT   ,
    "signature" TEXT   ,
    "transactionHash" TEXT   ,
    "transactionIndex" INTEGER   ,
    PRIMARY KEY ("id"),FOREIGN KEY ("address") REFERENCES "Contract"("address") ON DELETE SET NULL ON UPDATE CASCADE,
FOREIGN KEY ("address") REFERENCES "OracleAggregator"("contractAddress") ON DELETE SET NULL ON UPDATE CASCADE
) 

INSERT INTO "quaint"."new_Event" ("address", "blockHash", "blockNumber", "event", "id", "logIndex", "returnValues", "signature", "transactionHash", "transactionIndex") SELECT "address", "blockHash", "blockNumber", "event", "id", "logIndex", "returnValues", "signature", "transactionHash", "transactionIndex" FROM "quaint"."Event"

DROP TABLE "quaint"."Event";

ALTER TABLE "quaint"."new_Event" RENAME TO "Event";

PRAGMA "quaint".foreign_key_check;

PRAGMA foreign_keys=ON;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200417022021-migrate3..20200417185202-migrate4
--- datamodel.dml
+++ datamodel.dml
@@ -4,9 +4,9 @@
 }
 datasource db {
   provider = "sqlite"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 model Operator {
   id   Int    @default(autoincrement()) @id
@@ -32,9 +32,9 @@
   contracts Contract[] @relation("EventContracts", references: [address])
 }
 model Event {
-  id               String  @id
+  id               String            @id
   returnValues     String?
   event            String?
   signature        String?
   logIndex         Int?
@@ -42,14 +42,15 @@
   transactionHash  String?
   blockHash        String?
   blockNumber      Int?
   address          String?
+  contract         Contract?         @relation("ContractEvents", fields: [address], references: [address])
+  oracleAggregator OracleAggregator? @relation("OracleAggregatorEvents", fields: [address], references: [contractAddress])
 }
 model OracleAggregator {
-  id                 Int      @default(autoincrement()) @id
+  contractAddress    String   @id
   contract           Contract @relation("OracleContracts", fields: [contractAddress], references: [address])
-  contractAddress    String
   title              String
   path               String
   answerRenderFormat String
 }
```


